
CREATE TABLE password_reset_otp (
    id BIGSERIAL PRIMARY KEY,

    -- Link OTP to a specific user account
    user_id UUID NOT NULL,

    -- OTP value (numeric or alphanumeric)
    otp_code VARCHAR(10) NOT NULL,

    -- OTP expiry timestamp
    expires_at TIMESTAMP NOT NULL,

    -- When the OTP was created
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,

    -- Marks whether OTP has already been used
    is_used BOOLEAN NOT NULL DEFAULT FALSE,

    -- Number of invalid attempts
    attempts INT NOT NULL DEFAULT 0,

    -- Track user device/ip (optional)
    request_ip VARCHAR(50),

    -- Foreign key to users table
    CONSTRAINT fk_user_otp
        FOREIGN KEY (user_id)
        REFERENCES users(user_id)
        ON DELETE CASCADE
);

